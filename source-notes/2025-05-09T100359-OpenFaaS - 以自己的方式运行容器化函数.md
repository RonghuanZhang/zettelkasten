---
type: fleet-note
title: OpenFaaS - ä»¥è‡ªå·±çš„æ–¹å¼è¿è¡Œå®¹å™¨åŒ–å‡½æ•°
id: 20250509100559
created: 2025-05-09T10:03:59
source:
  - web
url: https://atbug.com/openfaas-case-study-zh/
tags:
  - fleet-note
  - cloud-native/serverless
processed: false
archived: false
---
OpenFaaS - ä»¥è‡ªå·±çš„æ–¹å¼è¿è¡Œå®¹å™¨åŒ–å‡½æ•°

**è¯‘è€…æ³¨ï¼š** æœ¬æ–‡ç¯‡å¹…è¾ƒé•¿ï¼Œæœ‰åŠ©äºäº†è§£ FaaS å’Œ OpenFaaSã€‚ä½œè€…åˆ†åˆ«ä»å¼€å‘äººå‘˜å’Œè¿ç»´äººå‘˜çš„è§†è§’æ¥äº†è§£ OpenFaaSï¼Œå¯¹äº†è§£æ–°çš„æŠ€æœ¯æ˜¯ä¸ªå¾ˆå¥½çš„æ–¹å¼ã€‚

æœ¬æ–‡ç¿»è¯‘è‡ª [Ivan Velichko](https://twitter.com/iximiuz) çš„ [OpenFaaS - Run Containerized Functions On Your Own Terms](https://iximiuz.com/en/posts/openfaas-case-study/) ã€‚

---

é•¿æœŸä»¥æ¥ï¼Œ *æ— æœåŠ¡å™¨ï¼ˆserverlessï¼‰* å¯¹æˆ‘æ¥è¯´æ— éå°±æ˜¯ AWS Lambda çš„ä»£åè¯ã€‚Lambda æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„é€”å¾„ï¼Œå¯ä»¥å°†ä»»æ„ä»£ç é™„åŠ åˆ°å¹³å°äº‹ä»¶ï¼ˆäº‘å®ä¾‹çš„çŠ¶æ€å˜æ›´ã€DynamoDB è®°å½•çš„æ›´æ–°æˆ–æ–°çš„ SNS æ¶ˆæ¯ï¼‰ä¸­ã€‚ä½†æ˜¯ï¼Œæˆ‘æ—¶ä¸æ—¶ä¼šæƒ³åˆ°æŸä¸ªé€»è¾‘ï¼Œä½†å…¶åˆæ²¡å¤§åˆ°è¶³ä»¥æœ‰è‡ªå·±çš„æœåŠ¡ï¼ŒåŒæ—¶æœ‰ä¸é€‚åˆä»»ä½•ç°æœ‰æœåŠ¡çš„èŒƒå›´ã€‚å› æ­¤ï¼Œæˆ‘ç»å¸¸å°†å…¶æ”¾å…¥å‡½æ•°ä¸­ï¼Œä»¥ä¾¿æ—¥åä½¿ç”¨ CLI å‘½ä»¤æˆ–è€… HTTP è°ƒç”¨æ¥è°ƒç”¨å®ƒã€‚

å‡ å¹´å‰ï¼Œæˆ‘æ¥å¼€äº† AWSï¼Œè‡ªé‚£ä»¥åï¼Œæˆ‘ä¸€ç›´æ€€å¿µéƒ¨ç½²æ— æœåŠ¡å™¨åŠŸèƒ½çš„ä¾¿åˆ©æ€§ã€‚å› æ­¤ï¼Œå½“æˆ‘å¾—çŸ¥ [OpenFaaS](https://www.openfaas.com/) é¡¹ç›®æ—¶æƒŠå–œä¸‡åˆ†ã€‚å®ƒå°†åœ¨ Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½²å‡½æ•°å˜å¾—ç®€å•ï¼Œç”šè‡³ä»…éœ€è¦ Containerd å°±å¯ä»¥éƒ¨ç½²åˆ°è™šæ‹Ÿæœºä¸Šã€‚

æœ‰å…´è¶£ï¼Ÿé‚£ä¹ˆç»§ç»­ï¼

## æ— æœåŠ¡å™¨ä¸ FaaS

[æ— æœåŠ¡å™¨](https://en.wikipedia.org/wiki/Serverless_computing) å·²æˆä¸ºä¸€ä¸ªæµè¡Œè¯ï¼Œç›®å‰å…¶å®é™…å«ä¹‰æ‰”ä¸å¤Ÿæ¸…æ™°ã€‚

è®¸å¤šç°ä»£å¹³å°è¢«è§†ä¸º *æ— æœåŠ¡å™¨* å¹³å°ã€‚åœ¨ AWS Fargate æˆ– GCP Cloud Run ä¸Šéƒ¨ç½²å®¹å™¨åŒ–æœåŠ¡ï¼Ÿæ— æœåŠ¡å™¨ï¼åœ¨ Heroku ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºï¼Ÿä¹Ÿå¯èƒ½æ˜¯æ— æœåŠ¡å™¨çš„ã€‚

åŒæ—¶ï¼Œæˆ‘æ›´å–œæ¬¢å°† [FaaS](https://en.wikipedia.org/wiki/Function_as_a_service) è§†ä¸ºä¸€ç§å…·ä½“çš„è®¾è®¡æ¨¡å¼ã€‚æŒ‰ç…§ FaaS èŒƒå¼ï¼Œå¯ä»¥éƒ¨ç½²ä»£ç ç‰‡æ®µï¼ˆå“åº”æŸäº›å¤–éƒ¨æ—¶é—´æ‰§è¡Œçš„ *å‡½æ•°* ï¼‰ã€‚è¿™äº›å‡½æ•°ä¸äº‹ä»¶é©±åŠ¨ç¨‹åºä¸­çš„å›è°ƒç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯è¿è¡Œåœ¨å…¶ä»–äººçš„çš„æœåŠ¡å™¨ä¸Šã€‚ç”±äºæ“ä½œçš„æ˜¯å‡½æ•°è€Œä¸æ˜¯æœåŠ¡å™¨ï¼Œé¡¾åæ€ä¹‰ FaaS æ˜¯æ— æœåŠ¡å™¨çš„ã€‚

![](https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/12/17/20211217-at-001929.png) *[source](https://twitter.com/iximiuz/status/1465273596033609736?ref_src=twsrc%255Etfw%257Ctwcamp%255Etweetembed%257Ctwterm%255E1465273596033609736%257Ctwgr%255E%257Ctwcon%255Es1_&ref_url=https%253A%252F%252Fiximiuz.com%252Fen%252Fposts%252Fopenfaas-case-study%252F)*

**OpenFaaS é¡¹ç›®æ—¨åœ¨å°† Kubernetes é›†ç¾¤æˆ–è€…ç‹¬ç«‹çš„è™šæ‹Ÿæœºç­‰ä½çº§åŸºç¡€è®¾æ–½è½¬åŒ–ä¸ºç®¡ç†æ— æœåŠ¡å™¨å‡½æ•°çš„é«˜çº§å¹³å°ã€‚**

**ç«™åœ¨å¼€å‘äººå‘˜çš„è§’åº¦** ï¼Œè¿™æ ·ä¸€ä¸ªå¹³å°çœ‹èµ·æ¥æ˜¯çœŸçš„æ— æœåŠ¡å™¨çš„ â€“ ä½ åªéœ€è¦çŸ¥é“ç‰¹å®šçš„ CLI/UI/API æ¥å¤„ç† *å‡½æ•°* æŠ½è±¡ã€‚ä½† **ç«™åœ¨è¿ç»´çš„è§’åº¦** ï¼Œéœ€è¦äº†è§£ OpenFaaS å¦‚ä½•ä½¿ç”¨ *æœåŠ¡å™¨* æ¥è¿è¡Œè¿™äº›å‡½æ•°ã€‚

å°±æˆ‘è€Œè¨€ï¼Œæˆ‘ç»å¸¸æ—¢æ˜¯å¼€å‘åˆæ˜¯è¿ç»´ï¼Œä¸‹é¢æˆ‘å°†å°è¯•ä»äºŒè€…å±•å¼€è¯´æ˜ã€‚ç„¶è€Œï¼Œæˆ‘è®¤ä¸ºåœ¨è¯„ä¼° UX æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥æ˜ç¡®åŒºåˆ†å®ƒä»¬ã€‚

## å¼€å‘äººå‘˜çœ¼ä¸­çš„ OpenFaaS

OpenFaaS åˆ›å»ºäº 2016 å¹´ï¼Œç°åœ¨ç½‘ä¸Šä¹Ÿæœ‰å¤§é‡çš„æ•™ç¨‹ã€‚è¿™é‡Œä¸ä¼šé‡å¤ä»‹ç»ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹é“¾æ¥äº†è§£ï¼š

- [How to deploy OpenFaaS](https://docs.openfaas.com/deployment/)
- [Create Functions](https://docs.openfaas.com/cli/templates/)
- [Build Functions](https://docs.openfaas.com/cli/build/)
- [Writing a Node.js function - step-by-step guide](https://docs.openfaas.com/cli/templates/#nodejs-12-node12-of-watchdog-template)

ç›¸åï¼Œæˆ‘å°†æè¿°æˆ‘æ‰€ç†è§£çš„ OpenFaaSã€‚æˆ‘å¸Œæœ›æœ‰åŠ©äºä¸€äº›éœ€è¦è¯„ä¼°è¯¥æŠ€æœ¯æ˜¯å¦è§£å†³å…¶é—®é¢˜çš„äººï¼Œä»¥åŠé‚£äº›å¸Œæœ›æ›´æœ‰æ•ˆåœ°ä½¿ç”¨è¯¥æŠ€æœ¯çš„äººã€‚

### å‡½æ•°è¿è¡Œæ—¶

åœ¨è¿›å…¥æ­£å¼ç¼–ç ä¹‹å‰ï¼Œæœ‰å¿…è¦äº†è§£ä¸‹å…¶æœªæ¥çš„æ‰§è¡Œç¯å¢ƒï¼ˆåˆåè¿è¡Œæ—¶ï¼‰ã€‚æˆ–è€…ï¼Œç®€å•è¯´ï¼š

- å¦‚ä½•å¯åŠ¨å‡½æ•°
- å¦‚ä½•ç»„ç»‡ I/O æ“ä½œ
- å¦‚ä½•é‡ç½® / ç»ˆæ­¢å‡½æ•°
- å¦‚ä½•éš”ç¦»å‡½æ•°å’Œè°ƒç”¨

OpenFaaS è‡ªå¸¦å¤šä¸ªè¿è¡Œæ—¶æ¨¡å¼ï¼Œè¿™äº›æ¨¡å¼é’ˆå¯¹ä¸åŒçš„åœºæ™¯å®šåˆ¶ã€‚å› æ­¤ï¼Œä¸åŒçš„åœºæ™¯ä¸‹ä¸Šè¿°é—®é¢˜çš„ç­”æ¡ˆä¼šç•¥æœ‰ä¸åŒã€‚

**OpenFaaS å‡½æ•°åœ¨å®¹å™¨ä¸­è¿è¡Œ** ï¼Œå¹¶ä¸”æ¯ä¸ªå®¹å™¨å¿…é¡»éµå®ˆ [ç®€å•çš„çº¦å®š](https://docs.openfaas.com/reference/workloads/) ï¼šå®ƒä½œä¸ºç›‘å¬åœ¨é¢„è®¾ç«¯å£ï¼ˆé»˜è®¤ä¸º *8080* ï¼‰ä¸Šçš„ HTTP æœåŠ¡å™¨ï¼Œä¸´æ—¶å­˜å‚¨å¹¶ä¸”æ˜¯æ— çŠ¶æ€çš„ã€‚

ç„¶è€Œï¼ŒOpenFaaS é€šè¿‡ *å‡½æ•° watchdog* ï¼ˆè¯‘è€…æ³¨ï¼šwatchdog ä¸åšç¿»è¯‘ï¼‰æ¨¡å¼é¿å…äº†ç”¨æˆ·ç¼–å†™æ­¤ç±»æœåŠ¡å™¨ã€‚ *å‡½æ•° watchdog* æ˜¯ä¸€ç§è½»é‡çº§ HTTP æœåŠ¡å™¨ï¼Œå¯ä»¥æ„ŸçŸ¥å¦‚ä½•æ‰§è¡Œå®é™…å‡½æ•°ä¸šåŠ¡é€»è¾‘ã€‚å› æ­¤ï¼Œå®‰è£…åœ¨å®¹å™¨ä¸­çš„æ‰€æœ‰å†…å®¹åŠ ä¸Šä½œä¸ºå…¥å£ç‚¹çš„ watchdogï¼Œå°±æ„æˆäº†å‡½æ•°çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚

#### ç»å…¸ watchdog

ä» **æœ€ç®€å•** çš„å¼€å§‹ï¼Œæˆ–è€…åˆæ˜¯è¢«ç§°ä¸º [*ç»å…¸* watchdog](https://github.com/openfaas/classic-watchdog) ï¼š

![](https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/12/17/16396730767429.png)

è¿™ç§æ¨¡å¼ä¸‹ï¼Œwatchdog å¯åŠ¨äº†ç›‘å¬åœ¨ *8080* ç«¯å£çš„è½»é‡çº§ HTTP æœåŠ¡å™¨ï¼Œæ¯ä¸ªè¿›æ¥çš„è¯·æ±‚éƒ½ä¼šï¼š

- è¯»å–è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“
- fork æˆ–è€… exec åŒ…å«å®é™…å‡½æ•°çš„å¯æ‰§è¡Œæ–‡ä»¶
- å°†è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“å†™å…¥åˆ°å‡½æ•°è¿›ç¨‹çš„ *stdin*
- ç­‰å¾…å‡½æ•°è¿›ç¨‹çš„é€€å‡ºï¼ˆæˆ–è€…è¶…å¸‚ï¼‰
- è¯»å–å‡½æ•°è¿›ç¨‹çš„ *stdout* å’Œ *stderr*
- åœ¨ HTTP å“åº”ä¸­å°†å»è¯»çš„å­—èŠ‚å‘é€å›è°ƒç”¨æ–¹

ä¸Šè¿°é€»è¾‘ç±»ä¼¼äºä¼ ç»Ÿçš„ [é€šç”¨ç½‘å…³æ¥å£ï¼ˆCGIï¼‰](https://en.wikipedia.org/wiki/Common_Gateway_Interface) ã€‚ä¸€æ–¹é¢ï¼Œæ¯æ¬¡å‡½æ•°è°ƒç”¨éƒ½å¯åŠ¨å•ç‹¬çš„è¿›ç¨‹çœ‹èµ·æ¥ä¸å¤Ÿé«˜æ•ˆï¼Œè€Œå¦ä¸€æ–¹é¢ï¼Œå®ƒç¡®å®è¶…çº§æ–¹ä¾¿ï¼Œå› ä¸º **ä»»ä½•ä½¿ç”¨ *stdio* æµè¿›è¡Œ I/O å¤„ç†çš„ç¨‹åºï¼ˆåŒ…æ‹¬æœ€å–œæ¬¢çš„ CLI å·¥å…·ï¼‰éƒ½å¯ä»¥éƒ¨ç½²ä¸º OpenFaaS å‡½æ•°** ã€‚

æèµ· **éš”ç¦»** ï¼Œæˆ‘ä»¬æœ‰å¿…è¦åŒºåˆ†ä¸‹ *å‡½æ•°* å’Œ *è°ƒç”¨* ï¼š

- OpenFaaS ä¸­çš„ä¸åŒå‡½æ•°å§‹ç»ˆåˆ†å¸ƒåœ¨ä¸åŒçš„å®¹å™¨ä¸­
- ä¸€ä¸ªå‡½æ•°å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ â€”â€” å–å†³äºç¼©æ”¾é€‰é¡¹
- åŒä¸€å‡½æ•°çš„ç‹¬ç«‹è°ƒç”¨å¯èƒ½ä¼šæœ€ç»ˆè¿›å…¥åŒä¸€ä¸ªå®¹å™¨
- åŒä¸€å‡½æ•°çš„ç‹¬ç«‹è°ƒç”¨å°†å§‹ç»ˆä½¿ç”¨ä¸åŒçš„è¿›ç¨‹è¿›è¡Œ

#### åå‘ä»£ç† watchdog

*æ³¨æ„ï¼šä½¿ç”¨ OpenFaaS å®˜æ–¹æœ¯è¯­ï¼Œæœ¬èŠ‚è®¨è®ºåœ¨ HTTP æ¨¡å¼ä¸‹è¿è¡Œçš„ [of-watchdog](https://github.com/openfaas/of-watchdog) ã€‚ä½†æˆ‘ä¸ªäººè®¤ä¸ºç§°ä¹‹ä¸ºåå‘ä»£ç† watchdog æ›´åŠ å½¢è±¡ã€‚*

å¦‚æœ **ç»å…¸** è¿è¡Œæ—¶ç±»ä¼¼äº CGIï¼Œé‚£ä¹ˆè¿™ä¸ªè¿è¡Œæ—¶æ¨¡å¼ç±»ä¼¼äºåæ¥çš„ [FastCGI](https://en.wikipedia.org/wiki/FastCGI) ã€‚è¿è¡Œæ—¶å¸Œæœ›åœ¨ watchdog åé¢æœ‰ä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ HTTP æœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡å‡½æ•°è°ƒç”¨æ—¶åˆ›å»ºæ–°çš„è¿›ç¨‹ã€‚è¿™æœ¬è´¨ä¸Šæ˜¯ [å°† watchdog ç»„ä»¶å˜æˆåå‘ä»£ç†](https://github.com/openfaas/of-watchdog/blob/a0289419078824f0a070860f84a6b383eb4f2169/README.md#1-http-modehttp) ï¼š

![](https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/12/17/16396740301372.png)

å½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œ **åå‘ä»£ç†** watchdog ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªç›‘å¬åœ¨ *8080* ç«¯å£çš„è½»é‡çº§ HTTP æœåŠ¡å™¨ã€‚ç„¶è€Œï¼Œä¸ **ç»å…¸** watchdog ä¸åŒçš„æ˜¯ **åå‘ä»£ç†** watchdog åªåˆ›å»ºä¸€æ¬¡å‡½æ•°çš„è¿›ç¨‹ï¼Œå¹¶å°†å…¶å½“æˆï¼ˆé•¿æœŸè¿è¡Œçš„ï¼‰ä¸Šæ¸¸æœåŠ¡å™¨ã€‚ç„¶åï¼Œå‡½æ•°è°ƒç”¨è½¬å˜æˆåˆ°è¯¥ä¸Šæ¸¸çš„ HTTP è¯·æ±‚ã€‚

ç„¶è€Œï¼Œ **åå‘ä»£ç†** æ¨¡å¼å¹¶ä¸ä¸ºäº†å–ä»£ **ç»å…¸** æ¨¡å¼ã€‚ **ç»å…¸** æ¨¡å¼çš„å¼ºé¡¹åœ¨äºå…¶å‡½æ•°çš„ç¼–å†™éå¸¸ç®€å•ã€‚è¿™ä¹Ÿæ˜¯æ²¡æœ‰ HTTP æœåŠ¡å™¨çš„ä»£ç çš„å”¯ä¸€é€‰æ‹©ã€‚æ¯”å¦‚ä½¿ç”¨ Cobolã€bash æˆ–è€… PowerShell è„šæœ¬ç­‰ç­‰ç¼–å†™çš„å‡½æ•°ã€‚

ä½•æ—¶è¯¥ä½¿ç”¨ **åå‘ä»£ç†** è¿è¡Œæ—¶æ¨¡å¼ï¼š

- å‡½æ•°éœ€è¦åœ¨ä¸¤æ¬¡è°ƒç”¨ä¹‹é—´ä¿æŒçŠ¶æ€ï¼š
	- ç¼“å­˜
	- æŒä¹…è¿æ¥ï¼ˆä¾‹å¦‚ï¼Œä¿æŒä»å‡½æ•°åˆ°æ•°æ®åº“çš„è¿æ¥æ‰“å¼€ï¼‰
	- æœ‰çŠ¶æ€å‡½æ•° ğŸ¥´
- æ¯ä¸ªå‡½æ•°å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹å¯èƒ½å¼€é”€å¾ˆå¤§ï¼Œä¸ºæ¯ä¸ªè°ƒç”¨å¸¦æ¥äº†å»¶è¿Ÿ
- ä½ æƒ³è¿è¡Œä¸€ä¸ªï¼ˆå¾®ï¼‰æœåŠ¡ä½œä¸ºå‡½æ•° ğŸ¤”

> æ ¹æ® OpenFaaS çš„åˆ›å»ºè€… [Alex Ellis](https://twitter.com/alexellisuk) çš„è§£é‡Šï¼Œ *FaaS* ï¼Œç‰¹åˆ«æ˜¯ OpenFaaSï¼Œå¯ä»¥è¢«è§†ä¸ºåœ¨ä¸ä¾èµ–æœåŠ¡å™¨æŠ½è±¡çš„æƒ…å†µä¸‹ [éƒ¨ç½²å¾®æœåŠ¡çš„ç®€åŒ–æ–¹å¼](https://blog.alexellis.io/introducing-functions-as-a-service/) ã€‚å³ FaaS æ˜¯æ— æœåŠ¡å™¨æ¶æ„çš„è§„èŒƒç¤ºä¾‹ã€‚

å› æ­¤ï¼Œä½¿ç”¨åå‘ä»£ç†çš„æ–¹å¼ï¼Œå‡½æ•°å¯ä»¥è¢«çœ‹ä½œæ˜¯éƒ¨ç½²å¾®æœåŠ¡çš„å›ºæ‰§çš„æ–¹å¼ã€‚æ–¹ä¾¿ã€å¿«é€Ÿã€ç®€å•ã€‚ä½†ä½¿ç”¨æœ‰çŠ¶æ€å‡½æ•°æ—¶ï¼Œè¦ç•™æ„ç”±äºå¤šä¸ªè°ƒç”¨å¯èƒ½åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ç»“æŸè€Œå¯¼è‡´çš„è­¦å‘Šï¼š

- åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ç»“æŸçš„å¹¶å‘è°ƒç”¨å¯èƒ½ä¼šè§¦å‘ä»£ç ä¸­çš„ç«äº‰æ¡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªå¸¦æœ‰å…¨å±€å˜é‡çš„ Go å‡½æ•°ï¼Œè€Œå…¨å±€å˜é‡æ²¡æœ‰é”çš„ä¿æŠ¤ï¼‰ã€‚
- åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ç»“æŸçš„åç»­è°ƒç”¨å¯èƒ½ä¼šå¯¼è‡´äº¤å‰è°ƒç”¨æ•°æ®æ³„éœ²ï¼ˆå½“ç„¶ï¼Œå°±åƒä¼ ç»Ÿå¾®æœåŠ¡ä¸€æ ·ï¼‰ã€‚
- ç”±äºè¯¥è¿›ç¨‹åœ¨ä¸¤æ¬¡è°ƒç”¨ä¹‹é—´è¢«å¤ç”¨ï¼Œå› æ­¤ä»£ç ä¸­çš„ä»»ä½•å†…å­˜æ³„æ¼éƒ½ä¸ä¼šè¢«ç¼“è§£ã€‚

#### å…¶ä»–è¿è¡Œæ—¶æ¨¡å¼

**ç»å…¸** è¿è¡Œæ—¶æ¨¡å¼åœ¨å°†å‡½æ•°ç»“æœå‘é€å›è°ƒç”¨æ–¹ä¹‹å‰ç¼“å†²äº†å‡½æ•°çš„æ•´ä¸ªå“åº”ã€‚ä½†å¦‚æœå“åº”çš„å¤§å°è¶…å‡ºäº†å®¹å™¨çš„å†…å­˜æ€ä¹ˆåŠï¼ŸOpenFaaS æä¾›äº† [å¦ä¸€ç§è¿è¡Œæ—¶æ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä»ç„¶ä¸ºæ¯ä¸ªè°ƒç”¨åˆ›å»ºè¿›ç¨‹ï¼Œä½†æ·»åŠ äº† **å“åº”æµ**](https://github.com/openfaas/of-watchdog/blob/a0289419078824f0a070860f84a6b383eb4f2169/README.md#3-streaming-fork-modestreaming---default) ã€‚

å¦ä¸€ä¸ªåˆå»çš„åœºæ™¯æ˜¯ä»å‡½æ•°ä¸­æä¾›é™æ€æ–‡ä»¶æœåŠ¡ã€‚ [OpenFaaS ä¹Ÿæœ‰è§£å†³æ–¹æ¡ˆ](https://github.com/openfaas/of-watchdog/blob/a0289419078824f0a070860f84a6b383eb4f2169/README.md#4-static-modestatic) ã€‚

è¿™å¯èƒ½æ˜¯æ‰€æœ‰çš„å†…ç½®è¿è¡Œæ—¶æ¨¡å¼ã€‚ä½†å¦‚æœä»æœªæ»¡è¶³éœ€æ±‚ï¼ŒOpenFaaS æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼çœ‹ä¸‹ç°æœ‰çš„watchdogï¼ˆ [1](https://github.com/openfaas/classic-watchdog) Â &Â  [2](https://github.com/openfaas/of-watchdog) ï¼‰ï¼Œç®€æ´æ˜äº†ã€‚å› æ­¤ï¼Œå¯ä»¥éšæ—¶æäº¤ PR æˆ–è€… issueï¼Œè®©æ•´ä¸ªç¤¾åŒºå› ä½ çš„è´¡çŒ®æ”¶ç›Šã€‚

### ç¼–å†™å‡½æ•°

æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²ç»äº†è§£å‡½æ•°å¦‚ä½•åœ¨é…å¤‡äº†å‡½æ•° watchdog çš„å®¹å™¨ä¸­è¿è¡Œã€‚é‚£ä¹ˆæœ€å°çš„å‡½æ•°æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ

ä¸‹é¢çš„ç¤ºä¾‹å°†ç®€å•çš„ shell è„šæœ¬å°è£…åˆ° OpenFaaS å‡½æ•°ä¸­ï¼š

```dockerfile
########################################################
# WARNING: Not for Production - No Security Hardening! #
########################################################

# This FROM is just to get the watchdog executable.
FROM ghcr.io/openfaas/classic-watchdog:0.2.0 as watchdog

# FROM this line the actual runtime definion starts.
FROM alpine:latest

# Mandatory step - put the watchdog.
COPY --from=watchdog /fwatchdog /usr/bin/fwatchdog

# Optionally - install extra packages, libs, tools, etc.

# Function's payload - script echoing its STDIN, a bit transformed.
RUN echo '#!/bin/sh' > /echo.sh
RUN echo 'cat | rev | tr "[:lower:]" "[:upper:]"' >> /echo.sh
RUN chmod +x /echo.sh

# Point the watchdog to the actual thingy to run.
ENV fprocess="/echo.sh"

# Start the watchdog server.
CMD ["fwatchdog"]
```

å½“æ„å»ºã€éƒ¨ç½²å’Œè°ƒç”¨æ—¶ï¼Œä¸Šé¢çš„å‡½æ•°ä½œä¸º *å›æ˜¾æœåŠ¡å™¨* ï¼Œå€’è½¬å¹¶å¤§å†™å…¶è¾“å…¥ã€‚

ç¨å¾®é«˜çº§ç‚¹çš„ä¾‹å­ï¼šä¸€ä¸ª Node.js *Hello World* è„šæœ¬ä½œä¸ºå‡½æ•°ï¼š

```dockerfile
########################################################
# WARNING: Not for Production - No Security Hardening! #
########################################################

FROM ghcr.io/openfaas/classic-watchdog:0.2.0 as watchdog

FROM node:17-alpine

COPY --from=watchdog /fwatchdog /usr/bin/fwatchdog

RUN echo 'console.log("Hello World!")' > index.js

ENV fprocess="node index.js"

CMD ["fwatchdog"]
```

å› æ­¤ï¼Œè¦ç¼–å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œåªéœ€è¦åœ¨ Dockerfile ä¸­åŠ å…¥ï¼š

- å®é™…è„šæœ¬ï¼ˆæˆ–å¯æ‰§è¡Œæ–‡ä»¶ï¼‰
- å®ƒçš„æ‰€æœ‰ä¾èµ–é¡¹â€”â€”è½¯ä»¶åŒ…ã€æ“ä½œç³»ç»Ÿåº“ç­‰
- é¦–é€‰çš„ watchdog

ç„¶åå°† watchdog æŒ‡å‘è¯¥è„šæœ¬ï¼ˆæˆ–å¯æ‰§è¡Œæ–‡ä»¶ï¼‰ï¼Œå¹¶å°† watchdog ä½œä¸ºå…¥å£ã€‚æœ‰ç‚¹é…·ï¼Œå› ä¸ºï¼š

- å¯ä»¥å®Œå…¨æ§åˆ¶å‡½æ•°æœªæ¥çš„è¿è¡Œæ—¶
- å¯ä»¥éƒ¨ç½²ä»»ä½•å¯ä»¥åœ¨å®¹å™¨ä¸­ä½œä¸ºå‡½æ•°è¿è¡Œçš„ä¸œè¥¿

ä½†ä¸Šè¿°æ–¹æ³•æœ‰ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ â€“ ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„ Dockerfile å¯èƒ½æœ‰ä¸Šç™¾è¡Œã€‚å¦‚æœæˆ‘åªæƒ³è¿è¡Œä¸€ä¸ªç®€å•çš„ [Node.js / Python](http://node.js/Python) è„šæœ¬æˆ–è€…ä¸€ä¸ªå°çš„ Go ç¨‹åºä½œä¸ºå‡½æ•°ï¼Œè¦æ€ä¹ˆå¤„ç† Dockerfileï¼Ÿå°±ä¸èƒ½æœ‰ä¸€ä¸ªå ä½ç¬¦æ¥ç²˜è´´ä»£ç ç‰‡æ®µï¼Ÿ

#### åŠŸèƒ½æ¨¡æ¿

OpenFaaS çš„ç¾å¦™ä¹‹å¤„åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥ä¸¤è€…å…¼è€Œæœ‰ä¹‹ â€”â€” ä½¿ç”¨ Dockerfile è¿›è¡Œä½çº§ä¿®è¡¥æˆ–ç›®æ ‡è¯­è¨€ç¼–å†™é«˜çº§è„šæœ¬ï¼å¾—ç›Šäºä¸°å¯Œçš„åŠŸèƒ½æ¨¡æ¿åº“ï¼

```shell
$ faas-cli template store list
NAME                     SOURCE             DESCRIPTION
csharp                   openfaas           Classic C# template
dockerfile               openfaas           Classic Dockerfile template
go                       openfaas           Classic Golang template
java8                    openfaas           Java 8 template
...
node14                   openfaas           HTTP-based Node 14 template
node12                   openfaas           HTTP-based Node 12 template
node                     openfaas           Classic NodeJS 8 template
php7                     openfaas           Classic PHP 7 template
python                   openfaas           Classic Python 2.7 template
python3                  openfaas           Classic Python 3.6 template
...
python3-flask            openfaas           Python 3.7 Flask template
python3-http             openfaas           Python 3.7 with Flask and HTTP
...
golang-http              openfaas           Golang HTTP template
...
```

ä¸Šè¿°åŠŸèƒ½æ¨¡æ¿ç”± OpenFaaS ä½œè€…å’Œç¤¾åŒºç²¾å¿ƒåªåšã€‚å…¸å‹çš„æ¨¡æ¿é™„å¸¦ä¸€ä¸ªå¤æ‚çš„ Dockerfileï¼ŒæŒ‡å‘è™šæ‹Ÿå¤„ç†ç¨‹åºå‡½æ•°ã€‚å½“å¼•å¯¼æ–°å‡½æ•°æ—¶ï¼Œé€šè¿‡ `faas-cli new` å‘½ä»¤æ¥ä½¿ç”¨è¿™äº›æ¨¡æ¿ã€‚ä¾‹å¦‚ï¼š

```shell
$ faas-cli new --lang python my-fn
Folder: my-fn created.
Function created in folder: my-fn
Stack file written: my-fn.yml

$ cat my-fn/handler.py
def handle(req):
    """ PUT YOUR BUSINESS LOGIC HERE """
    return req
```

å› æ­¤ï¼Œå¯¹äºæ¨¡æ¿ï¼Œç¼–å†™å‡½æ•°çš„å·¥ä½œå¯ä»¥å½’ç»“ä¸ºç®€å•åœ°å°†ä¸šåŠ¡é€»è¾‘æ”¾å…¥å“åº”çš„å¤„ç†ç¨‹åºæ–‡ä»¶ä¸­ã€‚

ä½¿ç”¨æ¨¡æ¿æ—¶ï¼Œäº†è§£ä½¿ç”¨é‚£ç§ *watchdog* å’Œ *æ¨¡å¼* å¾ˆé‡è¦ï¼š

- ä½¿ç”¨ **ç»å…¸çš„** ç±»ä¼¼ CGI çš„ watchdogï¼Œå¤„ç†ç¨‹åºé€šå¸¸è¢«ç¼–å†™ä¸ºæ¥å—å’Œè¿”å›çº¯å­—ç¬¦ä¸²çš„å‡½æ•°ï¼ˆä¾‹å¦‚ï¼š [python3](https://github.com/openfaas/templates/blob/d8893afe3d1072840174911859c6f5db2986e814/template/python3/function/handler.py) ã€ [php7](https://github.com/openfaas/templates/blob/d8893afe3d1072840174911859c6f5db2986e814/template/php7/function/src/Handler.php) ï¼‰
- åœ¨ **HTTP æ¨¡å¼ä¸‹** ï¼Œä½¿ç”¨ **of-watchdog** æ—¶ï¼Œå¤„ç†ç¨‹åºçœ‹èµ·æ¥æ›´åƒ HTTP å¤„ç†ç¨‹åºæ¥å—è¯·æ±‚å¹¶è¿”å›å“åº”ç»“æ„ï¼ˆä¾‹å¦‚ï¼š [python3-http](https://github.com/openfaas/python-flask-template/blob/12db680950b42c7cfcc7d21ba036bd1397d62eb7/template/python3-http/function/handler.py) ï¼Œ [node17](https://github.com/openfaas/templates/blob/d8893afe3d1072840174911859c6f5db2986e814/template/node17/function/handler.js) ï¼‰ã€‚

#### å‡½æ•°å•†åº—

ä½ çš„æœ€ä½³å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿå¯¹ï¼Œä½ ä¸éœ€è¦å†™ã€‚OpenFaaS æ¥å—è¿™ç§æƒ³æ³•ï¼Œå¹¶å¸¦æ¥äº† [å‡½æ•°å•†åº—](https://github.com/openfaas/store) ï¼ˆç»è¿‡ç¤¾åŒºæµ‹è¯•å¹¶æ ¹æ®è¿‡å¾€ç»éªŒé€‰æ‹©çš„ OpenFaaS å‡½æ•°ç²¾é€‰ç´¢å¼•ï¼‰ã€‚

è¯¥å•†åº—åŒ…å«ä¸€äº›æœ‰è¶£çš„å‡½æ•°ï¼Œå¯ä»¥ä¸€é”®éƒ¨ç½²åˆ°ç°æœ‰çš„ OpenFaaS ä¸­ï¼š

```shell
$ faas-cli store list

FUNCTION                        DESCRIPTION
NodeInfo                        Get info about the machine that you'r...
alpine                          An Alpine Linux shell, set the "fproc...
env                             Print the environment variables prese...
sleep                           Simulate a 2s duration or pass an X-S...
shasum                          Generate a shasum for the given input
Figlet                          Generate ASCII logos with the figlet CLI
curl                            Use curl for network diagnostics, pas...
SentimentAnalysis               Python function provides a rating on ...
hey                             HTTP load generator, ApacheBench (ab)...
nslookup                        Query the nameserver for the IP addre...
SSL/TLS cert info               Returns SSL/TLS certificate informati...
Colorization                    Turn black and white photos to color ...
Inception                       This is a forked version of the work ...
Have I Been Pwned               The Have I Been Pwned function lets y...
Face Detection with Pigo        Detect faces in images using the Pigo...
Tesseract OCR                   This function brings OCR - Optical Ch...
Dockerhub Stats                 Golang function gives the count of re...
QR Code Generator - Go          QR Code generator using Go
Nmap Security Scanner           Tool for network discovery and securi...
ASCII Cows                      Generate a random ASCII cow
YouTube Video Downloader        Download YouTube videos as a function
OpenFaaS Text-to-Speech         Generate an MP3 of text using Google'...
Docker Image Manifest Query     Query an image on the Docker Hub for ...
face-detect with OpenCV         Detect faces in images. Send a URL as...
Face blur by Endre Simo         Blur out faces detected in JPEGs. Inv...
Left-Pad                        left-pad on OpenFaaS
normalisecolor                  Automatically fix white-balance in ph...
mememachine                     Turn any image into a meme.
Business Strategy Generator     Generates a Business Strategy (using ...
Image EXIF Reader               Reads EXIF information from an URL or...
Open NSFW Model                 Score images for NSFW (nudity) content.
Identicon Generator             Create an identicon from a provided s...
```

è¿™äº›å‡½æ•°å®é™…ä¸Šæ˜¯å­˜å‚¨åœ¨ Docker Hub æˆ–è€… Quay ç­‰å…¬å…±åº“çš„å®¹å™¨é•œåƒï¼Œå¯ä»¥è‡ªç”±å¤ç”¨ã€‚

åœºæ™¯ç¤ºä¾‹ï¼š

- ä½¿ç”¨ `env` å‡½æ•°è°ƒè¯•å‡½æ•°æ¥æ”¶çš„HTTPæ ‡å¤´
- ä½¿ç”¨ `curl` å‡½æ•°ä» OpenFaaS éƒ¨ç½²å†…éƒ¨æµ‹è¯•è¿æ¥
- ä»è¿è¡Œå¤šä¸ªå‰¯æœ¬çš„å‡½æ•°ä¸­ä½¿ç”¨ `hey` æ¥å¢åŠ è´Ÿè½½

### å‡½æ•°çš„æ„å»ºå’Œéƒ¨ç½²

ç”±äºå‡½æ•°æ˜¯åœ¨å®¹å™¨ä¸­è¿è¡Œçš„ï¼Œå› æ­¤éœ€è¦æœ‰äººä¸ºè¿™äº›å®¹å™¨æ„å»ºé•œåƒã€‚æ— è®ºä½ å–œä¸å–œæ¬¢ï¼Œè¿™éƒ½æ˜¯å¼€å‘äººå‘˜çš„äº‹æƒ…ã€‚OpenFaaS æä¾›äº†æ–¹ä¾¿çš„ `faas-cli build` å‘½ä»¤ï¼Œä½†æ²¡æœ‰æœåŠ¡å™¨ç«¯æ„å»ºã€‚å› æ­¤ï¼Œè¦ä¹ˆéœ€è¦ï¼ˆåœ¨å®‰è£… Docker çš„æœºå™¨ä¸Šï¼‰æ‰‹åŠ¨è¿è¡Œ `faas-cli build` ï¼Œè¦ä¹ˆä½¿ç”¨ CI/CD å®Œæˆã€‚

æ¥ä¸‹æ¥ï¼Œæ„å»ºå¥½çš„é•œåƒéœ€è¦é€šè¿‡ `faas-cli push` åˆ°ä»“åº“ã€‚æ˜¾ç„¶ï¼Œè¿™ç§ä»“åº“ä¹Ÿåº”è¯¥å¯ä»¥ä» OpenFaaS æœåŠ¡å™¨ç«¯è®¿é—®ã€‚å¦åˆ™ï¼Œä½¿ ç”¨ `faas-cli deploy` éƒ¨ç½²å‡½æ•°æ—¶ä¼šå¤±è´¥ã€‚

å¼€å‘äººå‘˜çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

![](https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/12/17/16396975427765.png)

### è°ƒç”¨å‡½æ•°

å‡½æ•°éƒ¨ç½²åï¼Œå¯ä»¥é€šè¿‡å‘ `$API_HOST:$API_PORT/function/<fn-name>` ç«¯ç‚¹å‘é€ GETã€POSTã€PUT æˆ–è€… DELET HTTP è¯·æ±‚æ¥è°ƒç”¨å®ƒã€‚å¸¸è§çš„è°ƒç”¨æ–¹å¼æœ‰ï¼š

- å„ç§é’©å­ï¼ˆwebhookï¼‰
- `faas-cli invoke`
- **event connectors** ï¼

å‰ä¸¤ä¸ªé€‰é¡¹ç›¸å½“ç®€å•ã€‚ä½¿ç”¨å‡½æ•°ä½œä¸ºä½œä¸º webhook å¤„ç†å™¨ï¼ˆGitHubã€IFTTT ç­‰ï¼‰å¾ˆæ–¹ä¾¿ï¼Œæ¯ä¸ªå‡½æ•°å¼€å‘äººå‘˜éƒ½å·²ç»å®‰è£…äº† `faas-cli` ï¼Œå› æ­¤å¯ä»¥æˆä¸ºæ—¥å¸¸è„šæœ¬ç¼–å†™çš„ç»„æˆéƒ¨åˆ†ã€‚

#### é‚£ä»€ä¹ˆæ˜¯äº‹ä»¶è¿æ¥å™¨ï¼Ÿ

åœ¨æœ¬æ–‡å¼€å¤´æ˜¯æˆ‘å¯¹ AWS Lambda ä¸ AWS å¹³å°äº‹ä»¶ç´§å¯†é›†æˆçš„æ¸©æš–å›å¿†ã€‚è¯·è®°ä½ï¼Œå¯ä»¥åœ¨å“åº”æ–° SQS/SNS æ¶ˆæ¯ã€æ–°çš„ Kinesis è®°å½•ã€EC2 å®ä¾‹ç”Ÿå‘½å‘¨æœŸç­‰äº‹ä»¶æ—¶è°ƒç”¨ Lambdaã€‚OpenFaaS å‡½æ•°æ˜¯å¦å­˜åœ¨ç±»ä¼¼çš„ä¸œè¥¿å‘¢ï¼Ÿ

æ˜¾ç„¶ï¼ŒOpenFaaS æ— æ³•å¼€ç®±å³ç”¨åœ°ä¸ä»»ä½•ç”Ÿæ€ç³»ç»Ÿé›†æˆã€‚ç„¶è€Œï¼Œå®ƒæä¾›äº†ä¸€ç§åä¸º [**äº‹ä»¶è¿æ¥å™¨**](https://docs.openfaas.com/reference/triggers/#event-connector-pattern) æ¨¡å¼çš„é€šç”¨è§£å†³æ–¹æ¡ˆã€‚

![](https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/12/17/16396992441046.png)

å®˜æ–¹æ”¯æŒçš„è¿æ¥å™¨ï¼š

- [Cron connector](https://github.com/openfaas/cron-connector)
- [MQTT connector](https://github.com/openfaas/mqtt-connector)
- [NATS connector](https://github.com/openfaas/nats-connector)
- [Kafka connector](https://docs.openfaas.com/reference/triggers/#apache-kafka-openfaas-pro) (éœ€è¦ **ä¸“ä¸šç‰ˆ** è®¢é˜…)

OpenFaaS è¿˜æä¾›äº†å¾ˆå°çš„ [**è¿æ¥å™¨-sdk**](https://github.com/openfaas/connector-sdk) åº“æ¥ç®€åŒ–è¿æ¥å™¨çš„å¼€å‘ã€‚

## è¿ç»´çœ¼ä¸­çš„ OpenFaaS

å¼€å‘çœ¼ä¸­çš„ OpenFaaS æ˜¯ä¸ªé»‘ç›’ï¼Œæä¾›ç®€å•çš„ API æ¥éƒ¨ç½²å’Œè°ƒç”¨å‡½æ•°ã€‚ç„¶è€Œï¼Œä½œä¸ºè¿ç»´å¯èƒ½ä¼šä»äº†è§£ ä¸€ç‚¹ OpenFaaS å†…éƒ¨åŸç†ä¸­å—ç›Šã€‚

### OpenFaaS é€šç”¨æ¶æ„

OpenFaaS æœ‰ä¸€ä¸ªç®€å•ä½†å¼ºå¤§çš„æ¶æ„ï¼Œå…è®¸ä½¿ç”¨ä¸åŒçš„åŸºç¡€è®¾æ–½ä½œä¸ºåç«¯ã€‚å¦‚æœå·²ç»æœ‰äº† Kubernetes é›†ç¾¤ï¼Œå¯ä»¥é€šè¿‡ [åœ¨ä¸Šé¢éƒ¨ç½² OpenFaaS](https://docs.openfaas.com/deployment/kubernetes/) è½»æ¾å°†å…¶å˜æˆ [FaaS](https://docs.openfaas.com/deployment/kubernetes/) è§£å†³æ–¹æ¡ˆã€‚ä½†æ˜¯å¦‚æœæ—§çš„è™šæ‹Ÿï¼ˆæˆ–ç‰©ç†ï¼‰æœºï¼Œä»ç„¶å¯ä»¥åœ¨ä¸Šé¢å®‰è£… OpenFaaSï¼Œå¹¶è·å¾—å·®ä¸å¤šåŠŸèƒ½çš„æ›´å°çš„ FaaS è§£å†³æ–¹æ¡ˆã€‚

![](https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/12/17/16396997846325.png)

ä¸Šé¢çš„æ¶æ„ä¸­å”¯ä¸€é¢å‘ç”¨æˆ·çš„ç»„ä»¶æ˜¯ [API ç½‘å…³](https://github.com/openfaas/faas/tree/fe152ba69c591d584b1f183f9f5f209e29a9b049/gateway) ã€‚OpenFaaS çš„ API ç½‘å…³ï¼š

- æš´éœ² API æ¥ç®¡ç†å’Œè°ƒç”¨å‡½æ•°
- æä¾›å†…ç½®çš„ UI æ¥ç®¡ç†å‡½æ•°
- å¤„ç†å‡½æ•°çš„è‡ªåŠ¨ç¼©æ”¾
- é¢„è®¡åé¢ä¼šæœ‰å…¼å®¹çš„ OpenFaaS æä¾›å•†

å› æ­¤ï¼Œå½“å¼€å‘äººå‘˜è¿è¡Œ `faas-cli deploy` ã€ `faas-cli list` æˆ–ä½¿ç”¨ `curl $API_URL/function/foobar` è°ƒç”¨å‡½æ•°ç­‰å†…å®¹æ—¶ï¼Œè¯·æ±‚å°†å‘é€åˆ°ä¸Šè¿°çš„ API ç½‘å…³ã€‚

ä¸Šå›¾ä¸­çš„å¦ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†æ˜¯ [faas-provider](https://github.com/openfaas/faas-provider) ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„ç»„ä»¶ï¼Œè€Œæ›´åƒæ˜¯æ¥å£ã€‚ä»»ä½•å®ç° [ï¼ˆéå¸¸ç®€æ´ï¼‰çš„æä¾›å•† API](https://github.com/openfaas/faas-provider/blob/36474d89ca995ea0a7c064493258d9edec88fe3f/serve.go#L32-L96) çš„è½¯ä»¶éƒ½å¯ä»¥æˆä¸ºæä¾›å•†ã€‚OpenFaaS æä¾›å•†ï¼š

- ç®¡ç†åŠŸèƒ½ï¼ˆéƒ¨ç½²ã€åˆ—è¡¨ã€ç¼©æ”¾ã€åˆ é™¤ï¼‰
- è°ƒç”¨å‡½æ•°
- æš´éœ²ä¸€äº›ç³»ç»Ÿä¿¡æ¯

ä¸¤ä¸ªæœ€æ³¨æ˜çš„æä¾›å•†æ˜¯ [faas-netes](https://github.com/openfaas/faas-netes) ï¼ˆKubernetes ä¸Šçš„ OpenFaaSï¼‰å’Œ [faasd](https://github.com/openfaas/faasd) ï¼ˆContainerd ä¸Šçš„ OpenFaaSï¼‰ã€‚ä¸‹é¢ï¼Œå°†ä»‹ç»ä»–ä»¬çš„å®ç°ã€‚

### Kubernetes ä¸Šçš„ OpenFaaSï¼ˆfaas-netsï¼‰

[å½“éƒ¨ç½²åœ¨ Kubernetes ä¸Šæ—¶](https://github.com/openfaas/faas-netes) ï¼ŒOpenFaaS åˆ©ç”¨äº†è¯¥å¹³å°å¼€ç®±å³ç”¨çš„å¼ºå¤§åŸè¯­ã€‚

![](https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/12/17/16397005465805.png)

å…³é”®è¦ç‚¹ï¼š

- API ç½‘å…³æˆä¸ºæ ‡å‡†ï¼ˆéƒ¨ç½²+æœåŠ¡ï¼‰å¯¹ã€‚å› æ­¤ï¼Œå¯ä»¥éšå¿ƒæ‰€æ¬²åœ°æ‰©å±•å®ƒã€‚ä¹Ÿå¯ä»¥éšå¿ƒæ‰€æ¬²åœ°æŠŠå®ƒæš´éœ²å‡ºæ¥
- æ¯ä¸ªå‡½æ•°ä¹Ÿæˆä¸ºï¼ˆéƒ¨ç½²+æœåŠ¡ï¼‰å¯¹ã€‚å¯èƒ½ä¸ä¼šç›´æ¥å¤„ç†å‡½æ•°ï¼Œä½†å¯¹äº faas-netesï¼Œç¼©æ”¾å˜å¾—å°±åƒè°ƒæ•´ç›¸åº”çš„å‰¯æœ¬æ•°ä¸€æ ·ç®€å•
- é«˜å¯ç”¨æ€§å’Œå¼€ç®±å³ç”¨çš„æ°´å¹³ç¼©æ”¾ - åŒä¸€åŠŸèƒ½çš„ pod å¯ä»¥ï¼ˆè€Œä¸”åº”è¯¥ï¼‰è·¨å¤šä¸ªé›†ç¾¤èŠ‚ç‚¹è¿è¡Œã€‚
- Kubernetes ä½œä¸ºä¸€ä¸ªæ•°æ®åº“å·¥ä½œï¼›ä¾‹å¦‚ï¼Œå½“è¿è¡Œ `faas-cli list` ç­‰å‘½ä»¤æ¥è·å–å½“å‰éƒ¨ç½²çš„å‡½æ•°åˆ—è¡¨æ—¶ï¼Œfaas-netes åªä¼šå°†å…¶è½¬æ¢ä¸ºç›¸åº”çš„ Kubernetes API æŸ¥è¯¢

### Containerd ä¸Šçš„ OpenFaaSï¼ˆfaasdï¼‰

å¯¹äºæ²¡æœ‰ä½¿ç”¨ Kubernetes é›†ç¾¤çš„äººæ¥è¯´ï¼ŒOpenFaaS æä¾›äº†åä¸º [faasd](https://github.com/openfaas/faasd) çš„æ›¿ä»£è½»é‡çº§æä¾›å•†ã€‚å®ƒå¯ä»¥å®‰è£…åœ¨ï¼ˆè™šæ‹Ÿæˆ–ç‰©ç†ï¼‰æœåŠ¡å™¨ä¸Šï¼Œï¼Œå¹¶åˆ©ç”¨ [containerd](https://iximiuz.com/en/posts/containerd-command-line-clients/) æ¥ç®¡ç†å®¹å™¨ã€‚ [æ­£å¦‚æˆ‘ä¹‹å‰å†™çš„é‚£æ ·](https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#containerd) ï¼Œå®¹å™¨æ˜¯ä¸€ä¸ªåœ¨ Docker å’Œ Kubernetes ä¸‹ä½¿ç”¨çš„è¾ƒä½çº§åˆ«çš„å®¹å™¨ç®¡ç†å™¨ã€‚ç»“åˆ [CNI æ’ä»¶](https://github.com/containernetworking/plugins) ï¼Œå®ƒæˆä¸ºç¼–å†™å®¹å™¨è°ƒåº¦å™¨çš„æ„å»ºç»„ä»¶ï¼ŒOpenFaaS çš„ faasd æ˜¯ä¸ªå¾ˆå¥½çš„è®²ç©¶æ¡ˆä¾‹ï¼š

![](https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/12/17/16397012181479.png)

å…³é”®è¦ç‚¹ï¼š

- è¢«è®¾è®¡ä¸ºåœ¨ IoT è®¾å¤‡ä¸Šæˆ– VM ä¸­è¿è¡Œ
- ä½¿ç”¨ containerd çš„åŸç”Ÿ `pause` Â ï¼ˆé€šè¿‡ *cgroup freezers* ï¼‰å’Œè¶…å¿«é€Ÿå‡½æ•°å†·å¯åŠ¨å¿«é€Ÿæ‰©å±•åˆ°é›¶
- [å®ƒå¯ä»¥åœ¨æ¯å°æœåŠ¡å™¨ä¸Šè¿è¡Œæ¯” faas-netes å¤šåå€çš„å‡½æ•°](https://metal.equinix.com/proximity/?wchannelid=ujj9b20qi5&wmediaid=hkkw4b4o5n) ï¼Œå¹¶ä¸”å¯ä»¥æœ‰æ•ˆåœ°ä½¿ç”¨æ›´ä¾¿å®œçš„ç¡¬ä»¶ï¼ŒåŒ…æ‹¬æ ‘è“æ´¾
- containerd å’Œ faasd ä½œä¸º systemd æœåŠ¡è¿›è¡Œç®¡ç†ï¼Œå› æ­¤ä¼šè‡ªåŠ¨å¤„ç†æ—¥å¿—ã€é‡å¯ç­‰
- æ²¡æœ‰ Kubernetes DNSï¼Œä½† faasd ç¡®ä¿ DNS åœ¨å‡½æ•°ä¹‹é—´å…±äº«ä»¥ç®€åŒ–äº’æ“ä½œ
- containerd æ‰®æ¼”ç€æ•°æ®åº“çš„è§’è‰²ï¼ˆæ¯”å¦‚ `faas-cli list` Â å˜æˆäº†ç±»ä¼¼Â  `ctr container list` çš„æ“ä½œ ï¼‰ï¼Œæ‰€ä»¥å¦‚æœæœåŠ¡å™¨æŒ‚äº†ï¼Œæ‰€æœ‰çŠ¶æ€å°±ä¼šä¸¢å¤±ï¼Œæ¯ä¸ªå‡½æ•°éƒ½éœ€è¦é‡æ–°éƒ¨ç½²
- æ²¡æœ‰å¼€ç®±å³ç”¨çš„é«˜å¯ç”¨æ€§æˆ–æ°´å¹³æ‰©å±•ï¼ˆå‚è§ [issue/225](https://github.com/openfaas/faasd/issues/225) ï¼‰

## æ€»ç»“

å¯¹ä½ æ‰€ä½¿ç”¨çš„è½¯ä»¶æœ‰ä¸ªå¥½çš„å¿ƒæ™ºæ¨¡å‹æ˜¯æ˜¯æœ‰ç›Šçš„ï¼Œå®ƒå¯ä»¥æé«˜å¼€å‘æ•ˆç‡ï¼Œé˜²æ­¢å•ä¾‹åœºæ™¯çš„å‘ç”Ÿï¼Œå¹¶ç®€åŒ–äº†æ•…éšœæ’æŸ¥ã€‚

ä»¥ OpenFaaS ä¸ºä¾‹ï¼ŒåŒºåˆ†å¼€å‘äººå‘˜å’Œè¿ç»´äººå‘˜å¯¹ç³»ç»Ÿçš„çœ‹æ³•å¯èƒ½æ˜¯ä¸ªå¾ˆå¥½çš„æ€è·¯ã€‚ä» **å¼€å‘äººå‘˜è§’åº¦æ¥çœ‹** ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„æ— æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦å…³æ³¨ FaaS åœºæ™¯ã€‚è¯¥è§£å†³æ–¹æ¡ˆç”±ä¸€ä¸ªç”¨äºç®¡ç†å’Œè°ƒç”¨å‡½æ•°çš„ç®€æ´ APIã€ä¸€ä¸ªæ¶µç›–å¼€å‘äººå‘˜å·¥ä½œæµçš„å‘½ä»¤è¡Œå·¥å…·ä»¥åŠä¸€ä¸ªå‡½æ•°æ¨¡æ¿åº“ç»„æˆã€‚æ— æœåŠ¡å™¨å‡½æ•°ä»¥ä¸åŒçš„è¿è¡Œæ—¶æ¨¡å¼ï¼ˆç±» CGIã€åå‘ä»£ç†ï¼‰åœ¨å®¹å™¨ä¸­è¿è¡Œï¼Œå¹¶æä¾›ä¸åŒçš„éš”ç¦»å’ŒçŠ¶æ€ä¿éšœã€‚

ä» **è¿ç»´äººå‘˜çš„è§’åº¦æ¥çœ‹** ï¼ŒOpenFaaS æ˜¯ä¸€ä¸ªå…·æœ‰çµæ´»æ¶æ„çš„æ¨¡å—åŒ–ç³»ç»Ÿï¼Œå¯ä»¥éƒ¨ç½²åœ¨ä¸åŒç±»å‹çš„åŸºç¡€è®¾æ–½ä¹‹ä¸Šï¼šä»æ ‘è“æ´¾åˆ°è£¸æœºæˆ–è™šæ‹Ÿæœºã€ä»¥åŠæˆç†Ÿçš„ Kubernetesã€OpenShift æˆ– Docker Swarm é›†ç¾¤ã€‚å½“ç„¶ï¼Œæ¯ç§é€‰æ‹©éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ï¼Œéœ€è¦è¯¦ç»†è¯„ä¼°å–èˆã€‚ä½†å³ä½¿ç°æœ‰é€‰é¡¹éƒ½ä¸åˆé€‚ï¼Œç®€å•çš„ *faas-provider* æŠ½è±¡å…è®¸å¼€å‘è‡ªå·±çš„åç«¯æ¥è¿è¡Œæ— æœåŠ¡å™¨åŠŸèƒ½ã€‚

ä¸Šè¿°å†…å®¹ä¸»è¦é›†ä¸­åœ¨ OpenFaaS åŸºç¡€çŸ¥è¯†ä¸Šã€‚ä½†æ˜¯ OpenFaaS ä¹Ÿæœ‰ä¸€äº›é«˜çº§åŠŸèƒ½ã€‚é€šè¿‡ä»¥ä¸‹é“¾æ¥è¿›ä¸€æ­¥äº†è§£ï¼š

- [ä½¿ç”¨ NATS æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿçš„å¼‚æ­¥å‡½æ•°è°ƒç”¨](https://docs.openfaas.com/reference/async/)
- [ä½¿ç”¨ Prometheus å’Œ AlertManager è‡ªåŠ¨ç¼©æ”¾åŠŸèƒ½](https://docs.openfaas.com/architecture/autoscaling/)
- [å‡½æ•°è°ƒç”¨é™åˆ¶](https://github.com/openfaas/faas-middleware/tree/ace4eb24749c0814850a56b23b0015232dd41c2a/concurrency-limiter)
- [ä½¿ç”¨ docker-compose é€šè¿‡ faasd è¿è¡Œæœ‰çŠ¶æ€çš„å·¥ä½œè´Ÿè½½](https://openfaas.gumroad.com/l/serverless-for-everyone-else)

### èµ„æº

- [OpenFaaS å®˜æ–¹æ–‡æ¡£](https://docs.openfaas.com/)
- [ä¸€å †æ¸…æ™°çš„ OpenFaaS ç”¨ä¾‹](https://blog.alexellis.io/deploy-serverless-faasd-with-cloud-init/)
- [ä½¿ç”¨ OpenFaaS å°†ä»»ä½• CLI è½¬æ¢ä¸ºå‡½æ•°](https://blog.alexellis.io/cli-functions-with-openfaas/)
- [faasd ä»‹ç»ã€åŠ¨æœºã€ä¸»è¦ç”¨ä¾‹](https://www.openfaas.com/blog/introducing-faasd/)
- ğŸ“– [é¢å‘å…¶ä»–äººçš„æ— æœåŠ¡å™¨](https://openfaas.gumroad.com/l/serverless-for-everyone-else) - å°½ç®¡æœ‰é€šç”¨åç§°ï¼Œä½†å®ƒæ˜¯ faasd çš„ä¸€ä¸ªéå¸¸è¯¦ç»†çš„æŒ‡å—

> ä½œè€…ä»‹ç»ï¼š Ivan Velichko Software Engineer at heart, SRE at day job, Tech Storyteller at night.

![](https://atbug.com/images/wechat_qr.jpg)

ï¼ˆè½¬è½½æœ¬ç«™æ–‡ç« è¯·æ³¨æ˜ä½œè€…å’Œå‡ºå¤„ [ä¹±ä¸–æµ®ç”Ÿ](https://atbug.com/) ï¼Œè¯·å‹¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”ï¼‰